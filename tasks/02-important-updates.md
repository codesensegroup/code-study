# âš ï¸ é‡è¦æ›´æ–°ä»»å‹™

å„ªå…ˆç´šï¼š**P1** | é è¨ˆæ™‚é–“ï¼š**1-2 å¤©**

> **ğŸ“ å‚™è¨»**ï¼šåœ–ç‰‡å„ªåŒ–å·²é€é PhotoSwipe è§£æ±ºï¼Œæœ¬æ–‡ä»¶å°ˆæ³¨æ–¼ä¾è³´å¥—ä»¶æ›´æ–°ã€‚

## 1. æ›´æ–°å°ç‰ˆæœ¬ä¾è³´å¥—ä»¶

**ç‹€æ…‹**ï¼šâœ… å·²å®Œæˆï¼ˆ2025-10-10ï¼‰

### å•é¡Œæè¿°

å°ˆæ¡ˆä¾è³´å¥—ä»¶ç‰ˆæœ¬åš´é‡éæ™‚ï¼Œå­˜åœ¨å®‰å…¨é¢¨éšªå’ŒåŠŸèƒ½ç¼ºå¤±ï¼š

```
å¥—ä»¶åç¨±                åŸå§‹ç‰ˆæœ¬   å·²æ›´æ–°ç‰ˆæœ¬  æœ€æ–°ç‰ˆæœ¬
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
nuxt                   3.8.1      3.19.3 âœ…   4.1.3
@nuxt/content          2.9.0      2.13.4 âœ…   3.7.1
@nuxt/devtools         1.0.2      1.7.0 âœ…    2.6.5
@nuxtjs/tailwindcss    6.9.5      6.14.0 âœ…   6.14.0
@nuxt-themes/docus     1.15.0     1.15.1 âœ…   1.15.1
@types/node            20.9.2     20.19.20 âœ… 24.7.0
@vueuse/core           10.6.1     10.11.1 âœ…  13.9.0
eslint                 8.54.0     8.57.1 âœ…   9.37.0
mermaid                10.9.1     10.9.4 âœ…  11.12.0
photoswipe             5.4.4      5.4.4 âœ…    5.4.4
zod                    3.22.4     3.25.76 âœ…  4.1.12
remark-math            5.1.1      6.0.0 âœ…    6.0.0
rehype-katex           (æ–°å¢)     7.0.1 âœ…    7.0.1
katex                  (æ–°å¢)     0.16.11 âœ…  0.16.11
```

> **âœ… å·²å®Œæˆ**: æ‰€æœ‰å¥—ä»¶å·²æ›´æ–°è‡³å»ºè­°ç‰ˆæœ¬ï¼ˆå«æ•¸å­¸å…¬å¼å¥—ä»¶å‡ç´šï¼‰

### å½±éŸ¿ç¯„åœ

- ğŸ”’ **å®‰å…¨æ€§**ï¼šèˆŠç‰ˆæœ¬å¯èƒ½å­˜åœ¨å·²çŸ¥æ¼æ´
- ğŸ› **ç©©å®šæ€§**ï¼šéŒ¯éé‡è¦ bug ä¿®å¾©
- âš¡ **æ•ˆèƒ½**ï¼šéŒ¯éæ•ˆèƒ½å„ªåŒ–æ›´æ–°
- ğŸ¯ **åŠŸèƒ½**ï¼šç„¡æ³•ä½¿ç”¨æ–°åŠŸèƒ½

### è§£æ±ºæ–¹æ¡ˆ

åˆ†éšæ®µæ›´æ–°ä¾è³´å¥—ä»¶ï¼š
1. **ç¬¬ä¸€éšæ®µ**ï¼šæ›´æ–°åŒä¸»ç‰ˆæœ¬çš„å°ç‰ˆæœ¬ï¼ˆå®‰å…¨ï¼‰
2. **ç¬¬äºŒéšæ®µ**ï¼šè©•ä¼°ä¸»ç‰ˆæœ¬å‡ç´šï¼ˆéœ€æ¸¬è©¦ï¼‰

### å¯¦ä½œæ­¥é©Ÿ

#### éšæ®µä¸€ï¼šå®‰å…¨æ›´æ–°ï¼ˆå°ç‰ˆæœ¬ï¼‰

1. **æ›´æ–° Nuxt ç”Ÿæ…‹ç³»çµ±**
   ```bash
   npm install nuxt@^3.19.3
   npm install @nuxt/content@^2.13.4
   npm install @nuxt/devtools@^1.7.0
   npm install @nuxt-themes/docus@^1.15.1
   npm install @nuxtjs/tailwindcss@^6.14.0
   ```

2. **æ›´æ–°é–‹ç™¼å·¥å…·**
   ```bash
   npm install @types/node@^20.19.19
   npm install eslint@^8.57.1
   ```

3. **æ›´æ–°ä¾è³´åº«**
   ```bash
   npm install @vueuse/core@^10.11.1
   npm install mermaid@^10.9.4
   npm install zod@^3.25.76

   # PhotoSwipe å·²å®‰è£æœ€æ–°ç‰ˆæœ¬ï¼Œç„¡éœ€æ›´æ–°
   # photoswipe@5.4.4 âœ…
   ```

4. **åŸ·è¡Œæ¸¬è©¦**
   ```bash
   # æ¸…é™¤å¿«å–
   rm -rf .nuxt node_modules/.cache

   # é‡æ–°å®‰è£
   npm install

   # æœ¬åœ°æ¸¬è©¦
   npm run dev

   # å»ºç½®æ¸¬è©¦
   npm run generate

   # Lint æª¢æŸ¥
   npm run lint
   ```

#### éšæ®µäºŒï¼šé©—è­‰åŠŸèƒ½

æ¸¬è©¦é‡é»é é¢ï¼š
- [ ] é¦–é è¼‰å…¥æ­£å¸¸
- [ ] å…§å®¹é é¢æ¸²æŸ“æ­£ç¢º
- [ ] åœ–ç‰‡é¡¯ç¤ºæ­£å¸¸
- [ ] Mermaid åœ–è¡¨æ¸²æŸ“
- [ ] æ•¸å­¸å…¬å¼æ¸²æŸ“ï¼ˆMathJaxï¼‰
- [ ] ç¨‹å¼ç¢¼é«˜äº®é¡¯ç¤º
- [ ] æœå°‹åŠŸèƒ½
- [ ] å°èˆªé¸å–®
- [ ] ä¸»é¡Œåˆ‡æ›ï¼ˆäº®/æš—ï¼‰

### æ½›åœ¨é¢¨éšª

| å¥—ä»¶ | é¢¨éšªç­‰ç´š | èªªæ˜ |
|------|---------|------|
| nuxt 3.8â†’3.19 | ğŸŸ¡ ä¸­ | å¯èƒ½æœ‰ breaking changesï¼Œéœ€æ¸¬è©¦ |
| @nuxt/content 2.9â†’2.13 | ğŸŸ¢ ä½ | å‘å¾Œç›¸å®¹æ€§å¥½ |
| eslint 8.54â†’8.57 | ğŸŸ¢ ä½ | è¦å‰‡å¯èƒ½æ–°å¢ï¼Œéœ€æª¢æŸ¥ |
| mermaid 10.9.1â†’10.9.4 | ğŸŸ¢ ä½ | å°ç‰ˆæœ¬æ›´æ–°ï¼Œé¢¨éšªä½ |
| photoswipe 5.4.4 | âœ… å·²å®Œæˆ | æœ€æ–°ç‰ˆæœ¬å·²å®‰è£ |

### å›é€€æ–¹æ¡ˆ

å¦‚æœæ›´æ–°å¾Œå‡ºç¾å•é¡Œï¼š

1. **å¿«é€Ÿå›é€€**
   ```bash
   git checkout package.json package-lock.json
   npm install
   ```

2. **å€‹åˆ¥é™ç´š**
   ```bash
   npm install <package>@<èˆŠç‰ˆæœ¬>
   ```

### é©—è­‰æ–¹å¼

- [x] `npm run dev` å•Ÿå‹•æˆåŠŸ
- [x] `npm run build` å»ºç½®æˆåŠŸ
- [x] `npm run generate` ç”ŸæˆæˆåŠŸ
- [x] `npm run lint` ç„¡éŒ¯èª¤ï¼ˆ17å€‹è­¦å‘Šï¼Œ0å€‹éŒ¯èª¤ï¼‰
- [ ] æ‰€æœ‰æ¸¬è©¦é é¢åŠŸèƒ½æ­£å¸¸
- [ ] ç€è¦½å™¨ console ç„¡éŒ¯èª¤
- [ ] GitHub Actions å»ºç½®é€šé

### ç›¸é—œæª”æ¡ˆ

- [package.json](../package.json)
- [package-lock.json](../package-lock.json)
- [nuxt.config.ts](../nuxt.config.ts)

### åƒè€ƒè³‡æ–™

- [Nuxt 3 Upgrade Guide](https://nuxt.com/docs/getting-started/upgrade)
- [npm outdated](https://docs.npmjs.com/cli/v9/commands/npm-outdated)

---

## 2. ~~åœ–ç‰‡å„ªåŒ–~~ âœ… å·²é€éå…¶ä»–æ–¹å¼è§£æ±º

**ç‹€æ…‹**ï¼šâœ… å·²å®Œæˆ

### è§£æ±ºæ–¹æ¡ˆ

åœ–ç‰‡ç¸®æ”¾èˆ‡ä½¿ç”¨è€…é«”é©—å·²é€é **PhotoSwipe v5** è§£æ±ºï¼š

- âœ… **åœ–ç‰‡ç¸®æ”¾åŠŸèƒ½**ï¼šå°ˆæ¥­çš„ç‡ˆç®±æŸ¥çœ‹å™¨
- âœ… **æ‡¶è¼‰å…¥**ï¼š`loading="lazy"` å±¬æ€§å·²å•Ÿç”¨
- âœ… **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šæ”¯æ´æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢
- âœ… **ä½¿ç”¨è€…é«”é©—**ï¼šé»æ“Šæ”¾å¤§ã€æ»¾è¼ªç¸®æ”¾ã€æ‹–æ›³ç§»å‹•

### ç‚ºä½•æš«ä¸ä½¿ç”¨ @nuxt/image

1. **è¤‡é›œåº¦è€ƒé‡**ï¼šPhotoSwipe å·²æ»¿è¶³ç›®å‰éœ€æ±‚
2. **å»ºç½®æ™‚é–“**ï¼šåœ–ç‰‡å„ªåŒ–æœƒå¢åŠ  GitHub Actions å»ºç½®æ™‚é–“
3. **è·¯å¾‘è™•ç†**ï¼šé¿å…èˆ‡ç¾æœ‰ BASE_URL æ©Ÿåˆ¶è¡çª
4. **ç¶­è­·æˆæœ¬**ï¼šä¿æŒå°ˆæ¡ˆç°¡æ½”ï¼Œå°ˆæ³¨æ ¸å¿ƒåŠŸèƒ½

### æœªä¾†å¯è€ƒæ…®çš„å„ªåŒ–ï¼ˆéå¿…è¦ï¼‰

è‹¥ç¶²ç«™æµé‡å¤§å¹…å¢åŠ æˆ–æ•ˆèƒ½æˆç‚ºç“¶é ¸æ™‚ï¼Œå¯è€ƒæ…®ï¼š
- CDN åœ–ç‰‡è¨—ç®¡ï¼ˆCloudinaryã€imgixï¼‰
- æ‰‹å‹•æ‰¹æ¬¡å£“ç¸®åœ–ç‰‡ï¼ˆsharp-cliï¼‰
- Service Worker å¿«å–ç­–ç•¥

### ç›¸é—œå¯¦ä½œ

- [components/content/ProseImg.vue](../components/content/ProseImg.vue) - PhotoSwipe æ•´åˆ
- [tasks/01-urgent-fixes.md](./01-urgent-fixes.md) - Task 2 å¯¦ä½œè©³æƒ…

---

## å®Œæˆæª¢æŸ¥æ¸…å–®

### Task 1: æ›´æ–°ä¾è³´å¥—ä»¶
- [x] åŸ·è¡Œ `npm outdated` æª¢æŸ¥ç•¶å‰ç‰ˆæœ¬
- [x] æ›´æ–° Nuxt ç›¸é—œå¥—ä»¶ï¼ˆ3.8.1 â†’ 3.19.3ï¼‰
- [x] æ›´æ–°é–‹ç™¼å·¥å…·ï¼ˆeslint, @types/nodeï¼‰
- [x] æ›´æ–°ä¾è³´åº«ï¼ˆ@vueuse/core, mermaid, zodï¼‰
- [x] æ¸…é™¤å¿«å–ä¸¦é‡æ–°å®‰è£
- [x] æœ¬åœ°æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
- [x] åŸ·è¡Œ lint æª¢æŸ¥
- [x] å»ºç½®æ¸¬è©¦ï¼ˆ`npm run generate`ï¼‰
- [ ] æäº¤æ›´æ–°
- [ ] GitHub Actions é©—è­‰

### ~~Task 2: åœ–ç‰‡å„ªåŒ–~~ âœ… å·²å®Œæˆ
- [x] PhotoSwipe æ•´åˆå®Œæˆ
- [x] åœ–ç‰‡ç¸®æ”¾åŠŸèƒ½æ­£å¸¸
- [x] æ‡¶è¼‰å…¥å·²å•Ÿç”¨
- [x] éŸ¿æ‡‰å¼è¨­è¨ˆå·²æ”¯æ´

---

**é è¨ˆå®Œæˆæ™‚é–“**ï¼š1-2 å€‹å·¥ä½œå¤©
**å„ªå…ˆç´š**ï¼šâš ï¸ é«˜
**å½±éŸ¿ç¯„åœ**ï¼šå®‰å…¨æ€§ + ç©©å®šæ€§ + åŠŸèƒ½å®Œæ•´æ€§

---

## ğŸ“ æ›´æ–°æ‘˜è¦

### å·²å®Œæˆé …ç›®
- âœ… PhotoSwipe 5.4.4 å·²å®‰è£ï¼ˆåœ–ç‰‡ç¸®æ”¾åŠŸèƒ½ï¼‰
- âœ… åœ–ç‰‡å„ªåŒ–ç­–ç•¥å·²ç¢ºå®šï¼ˆæš«ä¸ä½¿ç”¨ @nuxt/imageï¼‰
- âœ… ä¾è³´å¥—ä»¶ç‰ˆæœ¬æ›´æ–°ï¼ˆå·²æ›´æ–°è‡³å»ºè­°ç‰ˆæœ¬ï¼‰

### å¾…è™•ç†é …ç›®
- â³ æäº¤æ›´æ–°ä¸¦é©—è­‰ GitHub Actions å»ºç½®

### é—œéµç‰ˆæœ¬è³‡è¨Š
```
æ›´æ–°å®Œæˆç‹€æ…‹ï¼š
- Nuxt: 3.8.1 â†’ 3.19.3 âœ…
- @nuxt/content: 2.9.0 â†’ 2.13.4 âœ…
- @nuxt/devtools: 1.0.2 â†’ 1.7.0 âœ…
- @nuxtjs/tailwindcss: 6.9.5 â†’ 6.14.0 âœ…
- @nuxt-themes/docus: 1.15.0 â†’ 1.15.1 âœ…
- @types/node: 20.9.2 â†’ 20.19.20 âœ…
- @vueuse/core: 10.6.1 â†’ 10.11.1 âœ…
- eslint: 8.54.0 â†’ 8.57.1 âœ…
- mermaid: 10.9.1 â†’ 10.9.4 âœ…
- zod: 3.22.4 â†’ 3.25.76 âœ…
- PhotoSwipe: 5.4.4 âœ… (æœ€æ–°)
```

### æ›´æ–°çµæœ

**æˆåŠŸé …ç›®ï¼š**
- âœ… æ‰€æœ‰å¥—ä»¶æˆåŠŸæ›´æ–°è‡³å»ºè­°ç‰ˆæœ¬
- âœ… é–‹ç™¼ä¼ºæœå™¨æ­£å¸¸å•Ÿå‹•ï¼ˆ`npm run dev`ï¼‰
- âœ… Lint æª¢æŸ¥é€šéï¼ˆ0 éŒ¯èª¤ï¼Œ17 è­¦å‘Šï¼‰
- âœ… å»ºç½®æµç¨‹æ­£å¸¸ï¼ˆ`npm run generate`ï¼‰
- âœ… ç›¸å®¹æ€§è­¦å‘Šå·²ä¿®å¾©ï¼ˆæ·»åŠ  `compatibilityDate: '2025-10-10'`ï¼‰
- âœ… æ•¸å­¸å…¬å¼è§£æéŒ¯èª¤å·²å®Œå…¨ä¿®å¾©ï¼ˆå‡ç´š remark-math v6 + rehype-mathjax v6ï¼‰

**å·²ä¿®å¾©çš„å•é¡Œï¼š**
- âœ… Nitro compatibilityDate è­¦å‘Šå·²æ¶ˆé™¤
- âœ… æ•¸å­¸å…¬å¼è§£æéŒ¯èª¤ï¼ˆ`exitMathText`ï¼‰å·²å®Œå…¨ä¿®å¾©
  - **æ ¹æœ¬åŸå› **ï¼š`remark-math@5.1.1` ä½¿ç”¨ `mdast-util-math@2.0.2` èˆ‡ `@nuxt/content@2.13.4` å…§éƒ¨çš„ `mdast-util-from-markdown@2.0.2` ç‰ˆæœ¬ä¸ç›¸å®¹
  - **è§£æ±ºæ–¹æ¡ˆ**ï¼šå‡ç´šåˆ° `remark-math@6.0.0` + `rehype-mathjax@6.0.0`ï¼Œä½¿ç”¨ `mdast-util-math@3.0.0` å®Œå…¨ç›¸å®¹ unified v11 ç”Ÿæ…‹ç³»çµ±
- âš ï¸ fs.Stats æ£„ç”¨è­¦å‘Šä¿ç•™ï¼ˆä¾†è‡ªä¾è³´å¥—ä»¶ï¼Œä¸å½±éŸ¿åŠŸèƒ½ï¼‰

**å¥—ä»¶ç‰ˆæœ¬è®Šæ›´ï¼š**
- `remark-math`: 5.1.1 â†’ **6.0.0** âœ…
- `rehype-mathjax`: 5.0.0 â†’ **å·²ç§»é™¤**
- `rehype-katex`: **æ–°å®‰è£ 7.0.1** âœ…
- `katex`: **æ–°å®‰è£ 0.16.11** âœ…
- `mdast-util-math`: 2.0.2 â†’ **3.0.0** âœ…ï¼ˆè‡ªå‹•å‡ç´šï¼‰
- ç¾åœ¨å®Œå…¨ç›¸å®¹ `unified@11.x` å’Œ `mdast-util-from-markdown@2.x`

**é—œéµä¿®å¾©ï¼š**
- âœ… å¾ MathJax åˆ‡æ›åˆ° KaTeXï¼Œå®Œå…¨è§£æ±º Vue è‡ªå®šç¾©å…ƒç´ è­¦å‘Š
- âœ… ä¿®å¾© SPA è·¯ç”±åˆ‡æ›æ™‚æ•¸å­¸å…¬å¼æ¶ˆå¤±çš„ bug
- âœ… æ¸²æŸ“é€Ÿåº¦æ›´å¿«ï¼Œæª”æ¡ˆæ›´å°

**æ³¨æ„äº‹é …ï¼š**
- âš ï¸ Lint æœ‰ 17 å€‹ä»£ç¢¼é¢¨æ ¼è­¦å‘Šï¼ˆéé˜»æ–·æ€§å•é¡Œï¼‰
- â„¹ï¸ fs.Stats è­¦å‘Šä¾†è‡ªä¾è³´å¥—ä»¶ï¼Œéœ€ç­‰å¾…ä¸Šæ¸¸æ›´æ–°
- â„¹ï¸ å»ºè­°åœ¨çœŸå¯¦ç’°å¢ƒæ¸¬è©¦æ‰€æœ‰åŠŸèƒ½å¾Œå†æäº¤
- â„¹ï¸ æ•¸å­¸å…¬å¼èªæ³•èˆ‡ä¹‹å‰å®Œå…¨ç›¸å®¹ï¼Œç„¡éœ€ä¿®æ”¹ Markdown æ–‡ä»¶
